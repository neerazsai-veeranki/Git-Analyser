html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title GitHub Followers Infinite Scroll
    script(src="https://code.jquery.com/jquery-3.6.0.min.js")
    style.
      body {
          font-family: Arial, sans-serif;
          background-color: #f0f0f0;
          margin: 0;
          padding: 0;
      }
      #follower-list {
          list-style: none;
          padding: 0;
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
      }
      .follower-card {
          background-color: #fff;
          border-radius: 4px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          margin: 10px;
          width: 200px;
          padding: 10px;
          text-align: center;
      }
      .follower-avatar {
          width: 80px;
          height: 80px;
          border-radius: 50%;
          margin: 0 auto 10px;
          display: block;
      }
      .follower-details h3 {
          margin: 0;
          font-size: 18px;
      }
      .follower-details p {
          margin: 0;
          color: #666;
      }

  body
    ul#follower-list

  script.
    $(document).ready(function () {
        let page = 1;
        const perPage = 50;
        let loading = false;
        let allFollowersLoaded = false;
        
        // Use the userId variable passed from the server
        var userId = "#{userId}";

        function createFollowerCard(follower) {
            //- console.log(follower);
            //- f=follower;
            return `
                <div class="follower-card">
                    <img src="${follower.avatar_url}" alt="${follower.login}" class="follower-avatar">
                    <div class="follower-details">
                        <a href="./viewProfile?id=${follower.login}">${follower.login}</a>
                        <br>
                        <a href="./viewProfile?id=${follower.login}">ID: ${follower.id}</a>
                    </div>
                </div>
            `;
        }

        function fetchFollowers() {
            if (loading || allFollowersLoaded) return;
            loading = true;
            
            $.get(`https://api.github.com/users/${userId}/followers?page=${page}&per_page=${perPage}`)
                .done(function (data) {
                    if (data.length === 0) {
                        allFollowersLoaded = true;
                    } else {
                        data.forEach(function (follower) {
                            const cardHTML = createFollowerCard(follower);
                            $('#follower-list').append(cardHTML);
                        });
                        page++;
                    }
                    loading = false;
                })
                .fail(function (error) {
                    console.error('Error fetching data:', error);
                    loading = false;
                });
        }

        $(window).scroll(function () {
            if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
                fetchFollowers();
            }
        });

        fetchFollowers();
    });
//-   p.footer Copyright Â© 2023 My GitHub Analyser
